<!DOCTYPE html>

<html lang="ja" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Algorithm の定義 &#8212; 2DMAT 2.2.0 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=f63d8bfa" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku.css?v=dfa0e015" />
    <script src="../_static/documentation_options.js?v=2b075faf"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=4dbe4bdc"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="実行方法" href="usage.html" />
    <link rel="prev" title="Solver の定義" href="solver.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>2DMAT 2.2.0 ドキュメント</span></a></h1>
        <h2 class="heading"><span>Algorithm の定義</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="solver.html"><code class="docutils literal notranslate"><span class="pre">Solver</span></code> の定義</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">コンテンツ</a>
        &#160;&#160;::&#160;&#160;
        <a href="usage.html">実行方法</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="algorithm">
<h1><code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> の定義<a class="headerlink" href="#algorithm" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> クラスは <code class="docutils literal notranslate"><span class="pre">py2dmat.algorithm.AlgorithmBase</span></code> を継承したクラスとして定義します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">py2dmat</span>

<span class="k">class</span> <span class="nc">Algorithm</span><span class="p">(</span><span class="n">py2dmat</span><span class="o">.</span><span class="n">algorithm</span><span class="o">.</span><span class="n">AlgorithmBase</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<section id="algorithmbase">
<h2><code class="docutils literal notranslate"><span class="pre">AlgorithmBase</span></code><a class="headerlink" href="#algorithmbase" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">AlgorithmBase</span></code> クラスは次のメソッドを提供します。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">info:</span> <span class="pre">py2dmat.Info,</span> <span class="pre">runner:</span> <span class="pre">py2dmat.Runner</span> <span class="pre">=</span> <span class="pre">None)</span></code></p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">info</span></code> から <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> 共通の入力パラメータを読み取り、次のインスタンス変数を設定します。</p>
<blockquote>
<div><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">self.mpicomm:</span> <span class="pre">Optional[MPI.Comm]</span></code> : <code class="docutils literal notranslate"><span class="pre">MPI.COMM_WORLD</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mpi4py</span></code> の import に失敗した場合、 <code class="docutils literal notranslate"><span class="pre">None</span></code> が設定されます</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.mpisize:</span> <span class="pre">int</span></code> : MPIプロセス数</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mpi4py</span></code> の import に失敗した場合、 <code class="docutils literal notranslate"><span class="pre">1</span></code> が設定されます</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.mpirank:</span> <span class="pre">int</span></code> : MPIランク</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mpi4py</span></code> の import に失敗した場合、 <code class="docutils literal notranslate"><span class="pre">0</span></code> が設定されます</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.rng:</span> <span class="pre">np.random.Generator</span></code> : 擬似乱数生成器</p>
<blockquote>
<div><ul class="simple">
<li><p>擬似乱数の種について、詳細は <a class="reference internal" href="../input.html#input-algorithm"><span class="std std-ref">入力パラメータの [algorithm] セクション</span></a> を参照してください</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.dimension:</span> <span class="pre">int</span></code> : 探索パラメータ空間の次元</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.label_list:</span> <span class="pre">List[str]</span></code> : 各パラメータの名前</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.root_dir:</span> <span class="pre">pathlib.Path</span></code> : ルートディレクトリ</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">info.base[&quot;root_dir&quot;]</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.output_dir:</span> <span class="pre">pathlib.Path</span></code> : 出力ファイルを書き出すディレクトリ</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">info.base[&quot;root_dir&quot;]</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.proc_dir:</span> <span class="pre">pathlib.Path</span></code> : プロセスごとの作業用ディレクトリ</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">self.output_dir</span> <span class="pre">/</span> <span class="pre">str(self.mpirank)</span></code></p></li>
<li><p>ディレクトリが存在しない場合、自動的に作成されます</p></li>
<li><p>各プロセスで最適化アルゴリズムはこのディレクトリで実行されます</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.timer:</span> <span class="pre">Dict[str,</span> <span class="pre">Dict]</span></code> : 実行時間を保存するための辞書</p>
<blockquote>
<div><ul class="simple">
<li><p>空の辞書が3つ、 <code class="docutils literal notranslate"><span class="pre">&quot;prepare&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;run&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;post&quot;</span></code> という名前で定義されます</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">prepare(self)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>最適化アルゴリズムの前処理をします</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.run()</span></code> の前に実行する必要があります</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">run(self)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>最適化アルゴリズムを実行します</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.proc_dir</span></code> に移動し、 <code class="docutils literal notranslate"><span class="pre">self._run()</span></code> を実行した後、元のディレクトリに戻ります</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">post(self)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>最適化結果のファイル出力など、後処理を行います</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.output_dir</span></code> に移動し、 <code class="docutils literal notranslate"><span class="pre">self._post()</span></code> を実行した後、元のディレクトリに戻ります</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">self.run()</span></code> のあとに実行する必要があります</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">main(self)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">prepare</span></code>, <code class="docutils literal notranslate"><span class="pre">run</span></code>, <code class="docutils literal notranslate"><span class="pre">post</span></code> を順番に実行します</p></li>
<li><p>それぞれの関数でかかった時間を計測し、結果をファイル出力します</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">_read_param(self,</span> <span class="pre">info:</span> <span class="pre">py2dmat.Info)</span> <span class="pre">-&gt;</span> <span class="pre">Tuple[np.ndarray,</span> <span class="pre">np.ndarray,</span> <span class="pre">np.ndarray,</span> <span class="pre">np.ndarray]</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>連続なパラメータ空間を定義するためのヘルパーメソッドです</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">info.algorithm[&quot;param&quot;]</span></code> から探索パラメータの初期値や最小値、最大値、単位を取得します</p></li>
<li><p>詳細は <a class="reference internal" href="../algorithm/minsearch.html#minsearch-input-param"><span class="std std-ref">min_search の入力ファイル</span></a> を参照してください</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">_mesh_grid(self,</span> <span class="pre">info:</span> <span class="pre">py2dmat.Info,</span> <span class="pre">split:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False)</span> <span class="pre">-&gt;</span> <span class="pre">Tuple[np.ndarray,</span> <span class="pre">np.ndarray]</span></code></p>
<blockquote>
<div><ul>
<li><p>離散的なパラメータ空間を定義するためのヘルパーメソッドです</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">info.algorithm[&quot;param&quot;]</span></code> を読み取り次を返します:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">D</span></code> 次元の候補点 <code class="docutils literal notranslate"><span class="pre">N</span></code> 個からなる集合 (<code class="docutils literal notranslate"><span class="pre">NxD</span></code> 次元の行列として)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">N</span></code> 個の候補点のID(index)</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">split</span></code> が <code class="docutils literal notranslate"><span class="pre">True</span></code> の場合、候補点集合は分割され各MPI ランクに配られます</p></li>
<li><p>詳細は <a class="reference internal" href="../algorithm/mapper_mpi.html#mapper-input-param"><span class="std std-ref">mapper の入力ファイル</span></a> を参照してください</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="id1">
<h2><code class="docutils literal notranslate"><span class="pre">Algorithm</span></code><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> は少なくとも次のメソッドを定義しなければなりません。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">info:</span> <span class="pre">py2dmat.Info,</span> <span class="pre">runner:</span> <span class="pre">py2dmat.Runner</span> <span class="pre">=</span> <span class="pre">None)</span></code></p>
<blockquote>
<div><ul>
<li><p>引数はそのまま基底クラスのコンストラクタに転送してください</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">super().__init__(info=info,</span> <span class="pre">runner=runner)</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>入力パラメータである <code class="docutils literal notranslate"><span class="pre">info</span></code> から必要な設定を読み取り、保存してください</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">_prepare(self)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>最適化アルゴリズムの前処理を記述します</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">_run(self)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code></p>
<blockquote>
<div><ul>
<li><p>最適化アルゴリズムを記述します</p></li>
<li><p>探索パラメータ <code class="docutils literal notranslate"><span class="pre">x</span></code> から対応する目的関数の値 <code class="docutils literal notranslate"><span class="pre">f(x)</span></code> を得る方法</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">message</span> <span class="o">=</span> <span class="n">py2dmat</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span>
<span class="n">fx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">_post(self)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>最適化アルゴリズムの後処理を記述します</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="solver.html"><code class="docutils literal notranslate"><span class="pre">Solver</span></code> の定義</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">コンテンツ</a>
        &#160;&#160;::&#160;&#160;
        <a href="usage.html">実行方法</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; 著作権 2020-, 2DMAT developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>