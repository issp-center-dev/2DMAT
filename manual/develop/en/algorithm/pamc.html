<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Population Annealing Monte Carlo pamc &#8212; 2DMAT 2.3-dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku.css?v=dfa0e015" />
    <script src="../_static/documentation_options.js?v=4e4c84c2"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bayse optimization bayes" href="bayes.html" />
    <link rel="prev" title="Replica exchange Monte Carlo exchange" href="exchange.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>2DMAT 2.3-dev documentation</span></a></h1>
        <h2 class="heading"><span>Population Annealing Monte Carlo pamc</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="exchange.html">Replica exchange Monte Carlo <code class="docutils literal notranslate"><span class="pre">exchange</span></code></a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="bayes.html">Bayse optimization <code class="docutils literal notranslate"><span class="pre">bayes</span></code></a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="population-annealing-monte-carlo-pamc">
<h1>Population Annealing Monte Carlo <code class="docutils literal notranslate"><span class="pre">pamc</span></code><a class="headerlink" href="#population-annealing-monte-carlo-pamc" title="Link to this heading">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">pamc</span></code> explores the parameter space by using the Population Annealing Monte Carlo (PAMC) method.</p>
<section id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://mpi4py.readthedocs.io/en/stable/">mpi4py</a> should be installed for the MPI parallelization</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">mpi4py</span>
</pre></div>
</div>
</section>
<section id="input-parameters">
<h2>Input parameters<a class="headerlink" href="#input-parameters" title="Link to this heading">¶</a></h2>
<p>This has two subsections <code class="docutils literal notranslate"><span class="pre">algorithm.param</span></code> and <code class="docutils literal notranslate"><span class="pre">algorithm.pamc</span></code> .</p>
<section id="algorithm-param">
<h3>[<code class="docutils literal notranslate"><span class="pre">algorithm.param</span></code>]<a class="headerlink" href="#algorithm-param" title="Link to this heading">¶</a></h3>
<p>This defines a space to be explored.
When <code class="docutils literal notranslate"><span class="pre">mesh_path</span></code> key is defined the discrete space is used.
Otherwise, continuous space is used.</p>
<ul>
<li><p>Continuous space</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">initial_list</span></code></p>
<p>Format: List of float. Length should be equal to <code class="docutils literal notranslate"><span class="pre">dimension</span></code>.</p>
<p>Description: Initial value of parameters.
If not defined, these will be initialize randomly.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unit_list</span></code></p>
<p>Format: List of float. Length should be equal to <code class="docutils literal notranslate"><span class="pre">dimension</span></code>.</p>
<p>Description: Unit length of each parameter.
<code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> makes parameters dimensionless and normalized by dividing these by <code class="docutils literal notranslate"><span class="pre">unit_list</span></code>.
If not defined, each component will be 1.0.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_list</span></code></p>
<p>Format: List of float. Length should be equal to <code class="docutils literal notranslate"><span class="pre">dimension</span></code>.</p>
<dl class="simple">
<dt>Description: Minimum value of each parameter.</dt><dd><p>When a parameter falls below this value during the Monte Carlo search,
the solver is not evaluated and the value is considered infinite.</p>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_list</span></code></p>
<p>Format: List of float. Length should be equal to <code class="docutils literal notranslate"><span class="pre">dimension</span></code>.</p>
<dl class="simple">
<dt>Description: Maximum value of each parameter.</dt><dd><p>When a parameter exceeds this value during the Monte Carlo search,
the solver is not evaluated and the value is considered infinite.</p>
</dd>
</dl>
</li>
</ul>
</li>
<li><p>Discrete space</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mesh_path</span></code></p>
<p>Format: string</p>
<p>Description: Path to the mesh definition file.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">neighborlist_path</span></code></p>
<p>Format: string</p>
<p>Description: Path to the neighborhood-list file.</p>
</li>
</ul>
</li>
</ul>
</section>
<section id="algorithm-pamc">
<h3>[<code class="docutils literal notranslate"><span class="pre">algorithm.pamc</span></code>]<a class="headerlink" href="#algorithm-pamc" title="Link to this heading">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">numsteps</span></code></p>
<p>Format: Integer</p>
<p>Description: The number of Monte Carlo steps.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">numsteps_annealing</span></code></p>
<p>Format: Integer</p>
<p>Description: The number of interval Monte Carlo steps between lowering “temperature”.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">numT</span></code></p>
<p>Format: Integer</p>
<p>Description: The number of “temperature” points.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tmin</span></code></p>
<p>Format: Float</p>
<p>Description: The minimum value of the “temperature” (<span class="math notranslate nohighlight">\(T\)</span>).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tmax</span></code></p>
<p>Format: Float</p>
<p>Description: The maximum value of the “temperature” (<span class="math notranslate nohighlight">\(T\)</span>).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">bmin</span></code></p>
<p>Format: Float</p>
<p>Description: The minimum value of the “inverse temperature” (<span class="math notranslate nohighlight">\(\beta = 1/T\)</span>).
One of the “temperature” and “inverse temperature” should be defined.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">bmax</span></code></p>
<p>Format: Float</p>
<p>Description: The maximum value of the “inverse temperature” (<span class="math notranslate nohighlight">\(\beta = 1/T\)</span>).
One of the “temperature” and “inverse temperature” should be defined.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tlogspace</span></code></p>
<p>Format: Boolean (default: true)</p>
<p>Description: Whether to assign “temperature” to replicas equally spaced in the logarithmic space or not.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">nreplica_per_proc</span></code></p>
<p>Format: Integer (default: 1)</p>
<p>Description: The number of replicas in a MPI process.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">resampling_interval</span></code></p>
<p>Format: Integer (default: 1)</p>
<p>Description: The number of annealing processes between resampling of the replicas.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">fix_num_replicas</span></code></p>
<p>Format: Boolean (default: true)</p>
<p>Description: Whether to fix the number of replicas or not on resampling.</p>
</li>
</ul>
<section id="about-the-number-of-steps">
<h4>About the number of steps<a class="headerlink" href="#about-the-number-of-steps" title="Link to this heading">¶</a></h4>
<p>Specify just two of <code class="docutils literal notranslate"><span class="pre">numstep</span></code>, <code class="docutils literal notranslate"><span class="pre">numsteps_annealing</span></code>, and <code class="docutils literal notranslate"><span class="pre">numT</span></code>.
The value of the remaining one will be determined automatically.</p>
</section>
</section>
</section>
<section id="reference-file">
<h2>Reference file<a class="headerlink" href="#reference-file" title="Link to this heading">¶</a></h2>
<section id="mesh-definition-file">
<h3>Mesh definition file<a class="headerlink" href="#mesh-definition-file" title="Link to this heading">¶</a></h3>
<p>Define the grid space to be explored in this file.
The first column is the index of the mesh, and the second and subsequent columns are the values of variables.
Note that the index of the mesh will be ignored for this “algorithm”.</p>
<p>Below, a sample file is shown.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="mf">6.000000</span> <span class="mf">6.000000</span>
<span class="mi">2</span> <span class="mf">6.000000</span> <span class="mf">5.750000</span>
<span class="mi">3</span> <span class="mf">6.000000</span> <span class="mf">5.500000</span>
<span class="mi">4</span> <span class="mf">6.000000</span> <span class="mf">5.250000</span>
<span class="mi">5</span> <span class="mf">6.000000</span> <span class="mf">5.000000</span>
<span class="mi">6</span> <span class="mf">6.000000</span> <span class="mf">4.750000</span>
<span class="mi">7</span> <span class="mf">6.000000</span> <span class="mf">4.500000</span>
<span class="mi">8</span> <span class="mf">6.000000</span> <span class="mf">4.250000</span>
<span class="mi">9</span> <span class="mf">6.000000</span> <span class="mf">4.000000</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
<section id="neighborhood-list-file">
<h3>Neighborhood-list file<a class="headerlink" href="#neighborhood-list-file" title="Link to this heading">¶</a></h3>
<p>Before searching in the discrete space by Markov Chain Monte Carlo method,
we should define “neighborhoods” for each point <span class="math notranslate nohighlight">\(i\)</span>, which are points that a walker can move from <span class="math notranslate nohighlight">\(i\)</span>
A neighborhood-list file defines the list of neighborhoods.
In this file, the index of an initial point <span class="math notranslate nohighlight">\(i\)</span> is specified by the first column,
and the indices of final points <span class="math notranslate nohighlight">\(j\)</span> are specified by the second and successive columns.</p>
<p>An utility tool, <code class="docutils literal notranslate"><span class="pre">py2dmat_neighborlist</span></code> is available for generating a neighborhood-list file from a mesh file. For details, please see <a class="reference internal" href="../tool.html"><span class="doc">Related Tools</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="mi">1</span> <span class="mi">0</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span>
<span class="mi">2</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span>
<span class="mi">3</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span>
<span class="mi">4</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span>
<span class="mi">5</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
</section>
<section id="output-files">
<h2>Output files<a class="headerlink" href="#output-files" title="Link to this heading">¶</a></h2>
<section id="rank-trial-t-txt">
<h3><code class="docutils literal notranslate"><span class="pre">RANK/trial_T#.txt</span></code><a class="headerlink" href="#rank-trial-t-txt" title="Link to this heading">¶</a></h3>
<p>This file stores the suggested parameters and the corresponding value returned from the solver for each temperature point (specified by <code class="docutils literal notranslate"><span class="pre">#</span></code>).
The first column (<code class="docutils literal notranslate"><span class="pre">step</span></code>) is the index of the MC step.
The second column (<code class="docutils literal notranslate"><span class="pre">walker</span></code>) is the index of the walker in the process.
The third column (<code class="docutils literal notranslate"><span class="pre">beta</span></code>) is the inverse temperature of the replica.
The fourth column (<code class="docutils literal notranslate"><span class="pre">fx</span></code>) is the value of the solver.
The fifth - (4+dimension)-th columns are the coordinates.
The last two columns (<code class="docutils literal notranslate"><span class="pre">weight</span></code> and <code class="docutils literal notranslate"><span class="pre">ancestor</span></code>) are the Neal-Jarzynsky weight and the grand-ancestor of the replica.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># step walker beta fx x1 weight ancestor</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mf">0.0</span> <span class="mf">73.82799488298886</span> <span class="mf">8.592321856342956</span> <span class="mf">1.0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mf">0.0</span> <span class="mf">13.487174782058675</span> <span class="o">-</span><span class="mf">3.672488908364282</span> <span class="mf">1.0</span> <span class="mi">1</span>
<span class="mi">0</span> <span class="mi">2</span> <span class="mf">0.0</span> <span class="mf">39.96292704464803</span> <span class="o">-</span><span class="mf">6.321623766458111</span> <span class="mf">1.0</span> <span class="mi">2</span>
<span class="mi">0</span> <span class="mi">3</span> <span class="mf">0.0</span> <span class="mf">34.913851603463</span> <span class="o">-</span><span class="mf">5.908794428939206</span> <span class="mf">1.0</span> <span class="mi">3</span>
<span class="mi">0</span> <span class="mi">4</span> <span class="mf">0.0</span> <span class="mf">1.834671825646121</span> <span class="mf">1.354500581633733</span> <span class="mf">1.0</span> <span class="mi">4</span>
<span class="mi">0</span> <span class="mi">5</span> <span class="mf">0.0</span> <span class="mf">3.65151610695736</span> <span class="mf">1.910894059585031</span> <span class="mf">1.0</span> <span class="mi">5</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
<section id="rank-trial-txt">
<h3><code class="docutils literal notranslate"><span class="pre">RANK/trial.txt</span></code><a class="headerlink" href="#rank-trial-txt" title="Link to this heading">¶</a></h3>
<p>This is a combination of all the <code class="docutils literal notranslate"><span class="pre">trial_T#.txt</span></code> in one.</p>
</section>
<section id="rank-result-t-txt">
<h3><code class="docutils literal notranslate"><span class="pre">RANK/result_T#.txt</span></code><a class="headerlink" href="#rank-result-t-txt" title="Link to this heading">¶</a></h3>
<p>This file stores the sampled parameters and the corresponding value returned from the solver for each replica and each temperature.
This has the same format as <code class="docutils literal notranslate"><span class="pre">trial.txt</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># step walker beta fx x1 weight ancestor</span>
<span class="mi">0</span> <span class="mi">0</span> <span class="mf">0.0</span> <span class="mf">73.82799488298886</span> <span class="mf">8.592321856342956</span> <span class="mf">1.0</span> <span class="mi">0</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mf">0.0</span> <span class="mf">13.487174782058675</span> <span class="o">-</span><span class="mf">3.672488908364282</span> <span class="mf">1.0</span> <span class="mi">1</span>
<span class="mi">0</span> <span class="mi">2</span> <span class="mf">0.0</span> <span class="mf">39.96292704464803</span> <span class="o">-</span><span class="mf">6.321623766458111</span> <span class="mf">1.0</span> <span class="mi">2</span>
<span class="mi">0</span> <span class="mi">3</span> <span class="mf">0.0</span> <span class="mf">34.913851603463</span> <span class="o">-</span><span class="mf">5.908794428939206</span> <span class="mf">1.0</span> <span class="mi">3</span>
<span class="mi">0</span> <span class="mi">4</span> <span class="mf">0.0</span> <span class="mf">1.834671825646121</span> <span class="mf">1.354500581633733</span> <span class="mf">1.0</span> <span class="mi">4</span>
<span class="mi">0</span> <span class="mi">5</span> <span class="mf">0.0</span> <span class="mf">3.65151610695736</span> <span class="mf">1.910894059585031</span> <span class="mf">1.0</span> <span class="mi">5</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
<section id="rank-result-txt">
<h3><code class="docutils literal notranslate"><span class="pre">RANK/result.txt</span></code><a class="headerlink" href="#rank-result-txt" title="Link to this heading">¶</a></h3>
<p>This is a combination of all the <code class="docutils literal notranslate"><span class="pre">result_T#.txt</span></code> in one.</p>
</section>
<section id="best-result-txt">
<h3><code class="docutils literal notranslate"><span class="pre">best_result.txt</span></code><a class="headerlink" href="#best-result-txt" title="Link to this heading">¶</a></h3>
<p>The optimal value of the solver and the corresponding parameter among the all samples.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nprocs</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">rank</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">65</span>
<span class="n">fx</span> <span class="o">=</span> <span class="mf">0.008233957976993406</span>
<span class="n">z1</span> <span class="o">=</span> <span class="mf">4.221129370933539</span>
<span class="n">z2</span> <span class="o">=</span> <span class="mf">5.139591716517661</span>
</pre></div>
</div>
</section>
<section id="fx-txt">
<h3><code class="docutils literal notranslate"><span class="pre">fx.txt</span></code><a class="headerlink" href="#fx-txt" title="Link to this heading">¶</a></h3>
<p>This file stores statistical metrics over the all replicas for each temperature.
The first column is inverse temperature.
The second and third column are the expectation value and the standard error of the solver’s output (<span class="math notranslate nohighlight">\(f(x)\)</span>), respectively.
The fourth column is the number of replicas.
The fifth column is the logarithmic of the ratio between the normalization factors (partition functions)</p>
<div class="math notranslate nohighlight">
\[\log\frac{Z}{Z_0} = \log\int \mathrm{d}x e^{-\beta f(x)} - \log\int \mathrm{d}x e^{-\beta_0 f(x)},\]</div>
<p>where <span class="math notranslate nohighlight">\(\beta_0\)</span> is the minimum value of <span class="math notranslate nohighlight">\(\beta\)</span> used in the calculation.
The sixth column is the acceptance ratio of MC updates.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># $1: 1/T</span>
<span class="c1"># $2: mean of f(x)</span>
<span class="c1"># $3: standard error of f(x)</span>
<span class="c1"># $4: number of replicas</span>
<span class="c1"># $5: log(Z/Z0)</span>
<span class="c1"># $6: acceptance ratio</span>
<span class="mf">0.0</span> <span class="mf">33.36426034198166</span> <span class="mf">3.0193077565358273</span> <span class="mi">100</span> <span class="mf">0.0</span> <span class="mf">0.9804</span>
<span class="mf">0.1</span> <span class="mf">4.518006242920819</span> <span class="mf">0.9535301415484388</span> <span class="mi">100</span> <span class="o">-</span><span class="mf">1.2134775491597027</span> <span class="mf">0.9058</span>
<span class="mf">0.2</span> <span class="mf">1.5919146358616842</span> <span class="mf">0.2770369776964151</span> <span class="mi">100</span> <span class="o">-</span><span class="mf">1.538611313376179</span> <span class="mf">0.9004</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
</section>
<section id="algorithm">
<h2>Algorithm<a class="headerlink" href="#algorithm" title="Link to this heading">¶</a></h2>
<section id="goal">
<h3>Goal<a class="headerlink" href="#goal" title="Link to this heading">¶</a></h3>
<p>When the weight of the configuration <span class="math notranslate nohighlight">\(x\)</span> under some parameter <span class="math notranslate nohighlight">\(\beta_i\)</span> is given as <span class="math notranslate nohighlight">\(f_i(x)\)</span>
(e.g., the Bolzmann factor <span class="math notranslate nohighlight">\(f_i(x) = \exp[-\beta_i E(x)]\)</span> ),
the expectation value of <span class="math notranslate nohighlight">\(A\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[\langle A\rangle_i
= \frac{\int \mathrm{d}xA(x)f_i(x)}{\int \mathrm{d}x f_i(x)}
= \frac{1}{Z}\int \mathrm{d}xA(x)f_i(x)
= \int \mathrm{d}xA(x)\tilde{f}_i(x),\]</div>
<p>where <span class="math notranslate nohighlight">\(Z = \int \mathrm{d} x f_i(x)\)</span> is the normalization factor (partition function)
and <span class="math notranslate nohighlight">\(\tilde{f}(x) = f(x)/Z\)</span> is the probability of <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>Our goal is to numerically calculate the expectation value for each <span class="math notranslate nohighlight">\(\beta_i\)</span> and the (ratio of) the normalization factor.</p>
</section>
<section id="annealed-importance-sampling-ais-1">
<h3>Annealed Importance Sampling (AIS) [1]<a class="headerlink" href="#annealed-importance-sampling-ais-1" title="Link to this heading">¶</a></h3>
<p>First, we introduce a series of configurations <span class="math notranslate nohighlight">\(\{x_i\}\)</span> obeying the following joint probability</p>
<div class="math notranslate nohighlight">
\[\tilde{f}(x_0, x_1, \dots, x_n) = \tilde{f}_n(x_n) \tilde{T}_n(x_n, x_{n-1}) \tilde{T}_{n-1}(x_{n-1}, x_{n-2}) \cdots \tilde{T}_1(x_1, x_0),\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[\tilde{T}_i(x_i, x_{i-1}) = T_i(x_{i-1}, x_i) \frac{\tilde{f}_i(x_{i-1})}{\tilde{f}_i(x_i)},\]</div>
<p>where <span class="math notranslate nohighlight">\(T_i(x, x')\)</span> is a transition probability from <span class="math notranslate nohighlight">\(x\)</span> to <span class="math notranslate nohighlight">\(x'\)</span> under <span class="math notranslate nohighlight">\(\beta_i\)</span>
holding the balance condition,</p>
<div class="math notranslate nohighlight">
\[\int \mathrm{d}x \tilde{f}_i(x) T_i(x, x') = \tilde{f}_i(x').\]</div>
<p>It turns out that <span class="math notranslate nohighlight">\(\tilde{f}_n(x_n)\)</span> is the marginal distribution of <span class="math notranslate nohighlight">\(\tilde{f}(x_0, x_1, \dots, x_n)\)</span>, that is,</p>
<div class="math notranslate nohighlight">
\[\tilde{f}_n(x_n) = \int \prod_{i=0}^{n-1} \mathrm{d} x_i \tilde{f}(x_0, x_1, \dots, x_n),\]</div>
<p>from</p>
<div class="math notranslate nohighlight">
\[\int \mathrm{d} x_{i-1} \tilde{T}_i(x_i, x_{i-1})
= \int \mathrm{d} x_{i-1} \tilde{f}_i(x_{i-1}) T_i(x_{i-1}, x_i) / \tilde{f}_i(x_i)
= 1.\]</div>
<p>Consequently,
<span class="math notranslate nohighlight">\(\langle A \rangle_n\)</span> is represented by using the extended configuration <span class="math notranslate nohighlight">\(\{x_i\}\)</span> as</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{split}
\langle A \rangle_n
&amp;\equiv
\int \mathrm{d} x_n A(x_n) \tilde{f}_n(x_n) \\
&amp;= \int \prod_i \mathrm{d} x_i A(x_n) \tilde{f}(x_0, x_1, \dots, x_n).
\end{split}\end{split}\]</div>
<p>Unfortunately, it is difficult to generate directly a series of configurations <span class="math notranslate nohighlight">\(\{x_i\}\)</span>
following the distribution <span class="math notranslate nohighlight">\(\tilde{f}(x_0, x_1, \dots, x_n)\)</span>.
Then, instead of <span class="math notranslate nohighlight">\(\tilde{f}(x_0, x_1, \dots, x_n)\)</span>, we consider <span class="math notranslate nohighlight">\(\{x_i\}\)</span> obeying the joint distribution</p>
<div class="math notranslate nohighlight">
\[\tilde{g}(x_0, x_1, \dots, x_n) = \tilde{f}_0(x_0) T_1(x_0, x_1) T_2(x_1, x_2) \dots T_n(x_{n-1}, x_n),\]</div>
<p>by using the following the following scheme:</p>
<ol class="arabic simple">
<li><p>Generete <span class="math notranslate nohighlight">\(x_0\)</span> from the initial distribution <span class="math notranslate nohighlight">\(\tilde{f}_0(x)\)</span></p></li>
<li><p>Generate <span class="math notranslate nohighlight">\(x_{i+1}\)</span> from <span class="math notranslate nohighlight">\(x_i\)</span> through <span class="math notranslate nohighlight">\(T_{i+1}(x_i, x_{i+1})\)</span></p></li>
</ol>
<p>By using the reweighting method (or importance sampling method),
<span class="math notranslate nohighlight">\(\langle A \rangle_n\)</span> is rewritten as</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{split}
\langle A \rangle_n
&amp;= \int \prod_i \mathrm{d} x_i A(x_n) \tilde{f}(x_0, x_1, \dots, x_n) \\
&amp;= \int \prod_i \mathrm{d} x_i A(x_n) \frac{\tilde{f}(x_0, x_1, \dots, x_n)}{\tilde{g}(x_0, x_1, \dots, x_n)} \tilde{g}(x_0, x_1, \dots, x_n) \\
&amp;= \left\langle A\tilde{f}\big/\tilde{g} \right\rangle_{g, n}
\end{split}.\end{split}\]</div>
<p>Because the ratio between <span class="math notranslate nohighlight">\(\tilde{f}\)</span> and <span class="math notranslate nohighlight">\(\tilde{g}\)</span> is</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{split}
\frac{\tilde{f}(x_0, \dots, x_n)}{\tilde{g}(x_0, \dots, x_n)}
&amp;=
\frac{\tilde{f}_n(x_n)}{\tilde{f}_0(x_0)}
\prod_{i=1}^n \frac{\tilde{T}_i(x_i, x_{i-1})}{T(x_{i-1}, x_i)} \\
&amp;=
\frac{\tilde{f}_n(x_n)}{\tilde{f}_0(x_0)}
\prod_{i=1}^n \frac{\tilde{f}_i(x_{i-1})}{\tilde{f}_i(x_i)} \\
&amp;=
\frac{Z_0}{Z_n}
\frac{f_n(x_n)}{f_0(x_0)}
\prod_{i=1}^n \frac{f_i(x_{i-1})}{f_i(x_i)} \\
&amp;=
\frac{Z_0}{Z_n}
\prod_{i=0}^{n-1} \frac{f_{i+1}(x_{i})}{f_i(x_i)} \\
&amp;\equiv
\frac{Z_0}{Z_n} w_n(x_0, x_1, \dots, x_n),
\end{split}\end{split}\]</div>
<p>the form of the expectation value will be</p>
<div class="math notranslate nohighlight">
\[\langle A \rangle_n = \left\langle A\tilde{f}\big/\tilde{g} \right\rangle_{g, n}
= \frac{Z_0}{Z_n} \langle Aw_n \rangle_{g,n}.\]</div>
<p>Finally, the ratio between the normalization factors <span class="math notranslate nohighlight">\(Z_n/Z_0\)</span> can be evaluated as</p>
<div class="math notranslate nohighlight">
\[\frac{Z_n}{Z_0} = \langle w_n \rangle_{g,n},\]</div>
<p>and therefore the expectation value of <span class="math notranslate nohighlight">\(A\)</span> can be evaluated as a weighted arithmetic mean:</p>
<div class="math notranslate nohighlight">
\[\langle A \rangle_n = \frac{\langle Aw_n \rangle_{g,n}}{\langle w_n \rangle_{g,n}}.\]</div>
<p>This weight <span class="math notranslate nohighlight">\(w_n\)</span> is called as the Neal-Jarzynski weight.</p>
</section>
<section id="population-annealing-pa-2">
<h3>population annealing (PA) [2]<a class="headerlink" href="#population-annealing-pa-2" title="Link to this heading">¶</a></h3>
<p>Although the AIS method can estimate the expectation values of <span class="math notranslate nohighlight">\(A\)</span> for each parameter <span class="math notranslate nohighlight">\(\beta\)</span> as the form of weighted arithmetic mean,
the variance of weights <span class="math notranslate nohighlight">\(w\)</span> is generally large and then the accuracy of the result gets worse.
In order to overcome this problem, the population annealing Monte Carlo (PAMC) method resamples all the replicas according to the probability
<span class="math notranslate nohighlight">\(p^{(k)} = w^{(k)} / \sum_k w^{(k)}\)</span> at some periods and resets all the weights to unity.</p>
<p>The following pseudo code describes the scheme of PAMC:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
    <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">draw_from</span><span class="p">(</span><span class="n">β</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
        <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">],</span> <span class="n">β</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">],</span> <span class="n">β</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">interval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:],</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">transfer</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">β</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span> <span class="o">*</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
</pre></div>
</div>
<p>There are two resampling methods: one with a fixed number of replicas[2] and one without[3].</p>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h3>
<p>[1] R. M. Neal, Statistics and Computing <strong>11</strong>, 125-139 (2001).</p>
<p>[2] K. Hukushima and Y. Iba, AIP Conf. Proc. <strong>690</strong>, 200 (2003).</p>
<p>[3] J. Machta, PRE <strong>82</strong>, 026704 (2010).</p>
</section>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="exchange.html">Replica exchange Monte Carlo <code class="docutils literal notranslate"><span class="pre">exchange</span></code></a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="bayes.html">Bayse optimization <code class="docutils literal notranslate"><span class="pre">bayes</span></code></a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2020, Institute for Solid State Physics, University of Tokyo.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>